# Simplified Surround View - Package Structure & Integration Guide

This document explains how to organize the simplified surround view files and integrate them with your existing project.

## Package Overview

This simplified version removes:
- ❌ SVAutoCalib (auto-calibration)
- ❌ SVSeamDetection (seam detection)
- ❌ SVPedDetect (pedestrian detection)
- ❌ SVDisplayView (mouse controls)
- ❌ Undistortion support
- ❌ Tone mapping
- ❌ Rear view splitting

This simplified version keeps:
- ✅ 4-camera Ethernet streaming
- ✅ Spherical warping
- ✅ Multi-band blending
- ✅ Gain compensation
- ✅ OpenGL bowl rendering
- ✅ Car model overlay

---

## Directory Structure

```
SurroundViewSimple/
│
├── README.md                           # Main documentation (PROVIDED)
├── CMakeLists.txt                      # Build configuration (PROVIDED)
├── generate_calibration.py            # Calibration generator (PROVIDED)
│
├── include/                            # Header files
│   ├── SVConfig.hpp                   # ✅ NEW - System configuration
│   ├── SVAppSimple.hpp                # ✅ NEW - Simplified app
│   ├── SVStitcherSimple.hpp           # ✅ NEW - Simplified stitcher
│   ├── SVRenderSimple.hpp             # ✅ NEW - Simplified renderer
│   │
│   ├── SVEthernetCamera.hpp           # ✅ KEEP FROM ORIGINAL
│   ├── SVBlender.hpp                  # ✅ KEEP FROM ORIGINAL
│   ├── SVGainCompensator.hpp          # ✅ KEEP FROM ORIGINAL
│   ├── Bowl.hpp                       # ✅ KEEP FROM ORIGINAL
│   ├── OGLShader.hpp                  # ✅ KEEP FROM ORIGINAL
│   ├── Model.hpp                      # ✅ KEEP FROM ORIGINAL
│   └── Mesh.hpp                       # ✅ KEEP FROM ORIGINAL
│
├── src/                                # Source files
│   ├── main.cpp                       # ✅ NEW - Simplified entry point
│   ├── SVAppSimple.cpp                # ✅ NEW - App implementation
│   ├── SVStitcherSimple.cpp           # ✅ NEW - Stitcher implementation
│   ├── SVRenderSimple.cpp             # ✅ NEW - Renderer implementation
│   │
│   ├── SVEthernetCamera.cpp           # ✅ KEEP FROM ORIGINAL
│   ├── SVBlender.cpp                  # ✅ KEEP FROM ORIGINAL
│   ├── SVGainCompensator.cpp          # ✅ KEEP FROM ORIGINAL
│   ├── Bowl.cpp                       # ✅ KEEP FROM ORIGINAL
│   ├── OGLShader.cpp                  # ✅ KEEP FROM ORIGINAL
│   ├── Model.cpp                      # ✅ KEEP FROM ORIGINAL
│   └── Mesh.cpp                       # ✅ KEEP FROM ORIGINAL
│
├── cusrc/                              # CUDA kernels
│   ├── kernelblend.cu                 # ✅ KEEP FROM ORIGINAL
│   └── kernelgain.cu                  # ✅ KEEP FROM ORIGINAL
│
├── shaders/                            # OpenGL shaders
│   ├── surroundshadervert.glsl        # ✅ KEEP FROM ORIGINAL
│   ├── surroundshaderfrag.glsl        # ✅ KEEP FROM ORIGINAL
│   ├── carshadervert.glsl             # ✅ KEEP FROM ORIGINAL
│   ├── carshaderfrag.glsl             # ✅ KEEP FROM ORIGINAL
│   ├── blackrectshadervert.glsl       # (optional)
│   └── blackrectshaderfrag.glsl       # (optional)
│
├── models/                             # 3D models
│   └── Dodge Challenger SRT Hellcat 2015.obj  # ✅ KEEP FROM ORIGINAL
│
├── camparameters/                      # Calibration files (generated)
│   ├── Camparam0.yaml                 # Generated by script
│   ├── Camparam1.yaml                 # Generated by script
│   ├── Camparam2.yaml                 # Generated by script
│   ├── Camparam3.yaml                 # Generated by script
│   └── corner_warppts.yaml            # Generated by script
│
└── 3dparty/                            # Third-party libraries
    └── glm/                            # ✅ KEEP FROM ORIGINAL (GLM headers)
```

---

## Files to Remove from Original Project

These files are **NOT NEEDED** in the simplified version:

### Headers (include/)
- ❌ SVApp.hpp (replaced by SVAppSimple.hpp)
- ❌ SVAutoCalib.hpp
- ❌ SVSeamDetection.hpp
- ❌ SVPedDetect.hpp
- ❌ SVDisplayView.hpp
- ❌ SVStitcher.hpp (replaced by SVStitcherSimple.hpp)
- ❌ SVRender.hpp (replaced by SVRenderSimple.hpp)

### Source Files (src/)
- ❌ SVApp.cpp (replaced by SVAppSimple.cpp)
- ❌ SVAutoCalib.cpp
- ❌ SVSeamDetection.cpp
- ❌ SVPedDetect.cpp
- ❌ SVDisplayView.cpp
- ❌ SVStitcher.cpp (replaced by SVStitcherSimple.cpp)
- ❌ SVRender.cpp (replaced by SVRenderSimple.cpp)
- ❌ Any old main.cpp

### Folders
- ❌ calibrationData/ (no longer needed - we use YAML only)
- ❌ camera_calibration/ (scripts not needed)

---

## Step-by-Step Integration

### Option A: Start Fresh (Recommended)

1. **Create new project directory:**
   ```bash
   mkdir SurroundViewSimple
   cd SurroundViewSimple
   ```

2. **Copy files from package:**
   - Copy all provided files to appropriate locations
   - Copy necessary files from original project (listed above)

3. **Copy existing resources:**
   ```bash
   # From your original project
   cp -r /path/to/original/shaders ./
   cp -r /path/to/original/models ./
   cp -r /path/to/original/3dparty ./
   cp /path/to/original/src/SVEthernetCamera.cpp ./src/
   cp /path/to/original/include/SVEthernetCamera.hpp ./include/
   # ... (repeat for other kept files)
   ```

4. **Generate calibration:**
   ```bash
   mkdir camparameters
   cd camparameters
   python3 ../generate_calibration.py
   cd ..
   ```

5. **Build:**
   ```bash
   mkdir build && cd build
   cmake ..
   make -j4
   ```

### Option B: Modify Existing Project

1. **Backup original project:**
   ```bash
   cp -r SurroundView SurroundView-backup
   ```

2. **Remove unnecessary files:**
   ```bash
   cd SurroundView
   
   # Remove auto-calibration
   rm include/SVAutoCalib.hpp src/SVAutoCalib.cpp
   
   # Remove seam detection
   rm include/SVSeamDetection.hpp src/SVSeamDetection.cpp
   
   # Remove pedestrian detection
   rm include/SVPedDetect.hpp src/SVPedDetect.cpp
   
   # Remove display view
   rm include/SVDisplayView.hpp src/SVDisplayView.cpp
   
   # Remove old main files
   rm src/main.cpp src/SVApp.cpp src/SVStitcher.cpp src/SVRender.cpp
   rm include/SVApp.hpp include/SVStitcher.hpp include/SVRender.hpp
   ```

3. **Add new files:**
   - Copy all NEW files from package
   - Update CMakeLists.txt

4. **Generate calibration:**
   ```bash
   cd camparameters
   python3 ../generate_calibration.py
   ```

5. **Rebuild:**
   ```bash
   cd build
   rm -rf *
   cmake ..
   make -j4
   ```

---

## File Dependencies

### SVAppSimple requires:
- SVConfig.hpp
- SVEthernetCamera.hpp
- SVStitcherSimple.hpp
- SVRenderSimple.hpp

### SVStitcherSimple requires:
- SVConfig.hpp
- SVBlender.hpp
- SVGainCompensator.hpp
- OpenCV (core, calib3d, stitching, cudawarping, cudaimgproc)

### SVRenderSimple requires:
- SVConfig.hpp
- Bowl.hpp
- OGLShader.hpp
- Model.hpp
- OpenGL, GLFW, GLM

### SVEthernetCamera requires:
- GStreamer libraries
- CUDA runtime
- OpenCV

---

## Configuration Points

### 1. Camera Network (SVConfig.hpp)
```cpp
static const CameraConfig CAMERA_CONFIGS[NUM_CAMERAS] = {
    {"Front", "192.168.45.10", 5020},  // Modify IPs/ports here
    {"Left",  "192.168.45.11", 5021},
    {"Rear",  "192.168.45.12", 5022},
    {"Right", "192.168.45.13", 5023}
};
```

### 2. Camera Geometry (generate_calibration.py)
```python
# Modify these values:
horizontal_fov = 120  # Camera field of view
pitch_down = 20       # Camera tilt angle
```

### 3. Processing Performance (SVConfig.hpp)
```cpp
#define NUM_BLEND_BANDS 5      // Quality: 3-7
#define PROCESS_SCALE 0.65f    // Speed: 0.5-0.8
```

---

## Compilation Requirements

### Ubuntu packages:
```bash
sudo apt install -y \
    build-essential cmake pkg-config \
    libopencv-dev \
    libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
    libglfw3-dev libglm-dev \
    cuda-toolkit-10-2
```

### CMake minimum version: 3.10
### C++ standard: 17
### CUDA standard: 14

---

## Testing Checklist

After building, verify:

1. ✅ **Calibration files generated:**
   ```bash
   ls camparameters/
   # Should show: Camparam0-3.yaml, corner_warppts.yaml
   ```

2. ✅ **Executable created:**
   ```bash
   ls build/SurroundViewSimple
   ```

3. ✅ **Resources accessible:**
   ```bash
   ls shaders/
   ls models/
   ```

4. ✅ **Camera connectivity:**
   ```bash
   ping 192.168.45.10
   ping 192.168.45.11
   ping 192.168.45.12
   ping 192.168.45.13
   ```

5. ✅ **Run test:**
   ```bash
   cd build
   ./SurroundViewSimple ../camparameters
   ```

---

## Common Issues & Solutions

### Issue: "Cannot find SVAutoCalib.hpp"
**Solution:** Old CMakeLists.txt references removed files. Use provided CMakeLists.txt.

### Issue: Cameras not connecting
**Solution:** Check IPs in SVConfig.hpp match your camera addresses.

### Issue: Calibration files not found
**Solution:** Run `python3 generate_calibration.py` in camparameters/ folder.

### Issue: Low FPS
**Solution:** 
- Reduce OUTPUT_WIDTH/HEIGHT in SVConfig.hpp
- Reduce NUM_BLEND_BANDS to 3
- Increase PROCESS_SCALE to 0.8

### Issue: Stitching seams visible
**Solution:**
- Verify cameras are 90° apart
- Check focal length calculation in YAML files
- Ensure camera overlap is adequate

---

## Performance Optimization

For Jetson Nano:

1. **Use Power Mode 10W:**
   ```bash
   sudo nvpmodel -m 0
   sudo jetson_clocks
   ```

2. **Reduce resolution:**
   - OUTPUT_WIDTH: 1280 (instead of 1920)
   - OUTPUT_HEIGHT: 720 (instead of 1080)

3. **Reduce blend bands:**
   - NUM_BLEND_BANDS: 3 (instead of 5)

4. **Increase process scale:**
   - PROCESS_SCALE: 0.75f (instead of 0.65f)

Expected FPS on Jetson Nano:
- Default settings: 15-20 FPS
- Optimized settings: 25-30 FPS

---

## Summary

### Provided Files (NEW):
1. README.md
2. CMakeLists.txt
3. generate_calibration.py
4. SVConfig.hpp
5. SVAppSimple.hpp / .cpp
6. SVStitcherSimple.hpp / .cpp
7. SVRenderSimple.hpp / .cpp
8. main.cpp

### Files to Keep from Original:
1. SVEthernetCamera (.hpp/.cpp)
2. SVBlender (.hpp/.cpp)
3. SVGainCompensator (.hpp/.cpp)
4. Bowl (.hpp/.cpp)
5. OGLShader (.hpp/.cpp)
6. Model / Mesh (.hpp/.cpp)
7. CUDA kernels (cusrc/)
8. Shaders (shaders/)
9. Models (models/)
10. GLM headers (3dparty/glm)

### Total Line Count Reduction:
- Original: ~15,000 lines
- Simplified: ~5,000 lines
- **Reduction: 67%**

---

For questions or issues, refer to README.md troubleshooting section.
